<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - BoxIM ENLTbot</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                <a href="/">BoxIM ENLTbot</a>
            </div>
            <div class="navbar-menu">
                <a href="/dashboard">ä»ªè¡¨æ¿</a>
                {% if user.role == 'admin' %}
                <a href="/users">ç”¨æˆ·ç®¡ç†</a>
                <a href="/logs">ç³»ç»Ÿæ—¥å¿—</a>
                {% endif %}
                <a href="/settings" class="active">è®¾ç½®</a>
                <a href="/logout">é€€å‡º</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>
        
        <div class="card">
            <h3>ä¿®æ”¹å¯†ç </h3>
            <form id="change-password-form">
                <div class="form-group">
                    <label for="current-password">å½“å‰å¯†ç </label>
                    <input type="password" id="current-password" required placeholder="è¯·è¾“å…¥å½“å‰å¯†ç ">
                </div>
                
                <div class="form-group">
                    <label for="new-password">æ–°å¯†ç </label>
                    <input type="password" id="new-password" required placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰">
                </div>
                
                <div class="form-group">
                    <label for="confirm-password">ç¡®è®¤æ–°å¯†ç </label>
                    <input type="password" id="confirm-password" required placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                </div>
                
                <button type="submit" class="btn btn-primary">ä¿®æ”¹å¯†ç </button>
            </form>
        </div>
        
        <div class="card">
            <h3>ç³»ç»Ÿä¿¡æ¯</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Webç•Œé¢ç‰ˆæœ¬:</strong> v2.4.0
                </div>
                <div class="info-item">
                    <strong>å½“å‰ç”¨æˆ·:</strong> {{ user.username }}
                </div>
                <div class="info-item">
                    <strong>ç”¨æˆ·è§’è‰²:</strong> {{ user.role }}
                </div>
                <div class="info-item">
                    <strong>åˆ›å»ºæ—¶é—´:</strong> {{ user.created_at }}
                </div>
            </div>
        </div>
        
        <div class="info">
            <h3>ğŸ”’ å®‰å…¨æç¤º</h3>
            <ul>
                <li>è¯·å®šæœŸä¿®æ”¹å¯†ç ï¼Œå»ºè®®æ¯3ä¸ªæœˆä¿®æ”¹ä¸€æ¬¡</li>
                <li>å¯†ç åº”åŒ…å«å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦</li>
                <li>ä¸è¦ä½¿ç”¨ä¸å…¶ä»–ç½‘ç«™ç›¸åŒçš„å¯†ç </li>
                <li>é€€å‡ºæ—¶è¯·ç‚¹å‡»"é€€å‡º"æŒ‰é’®ï¼Œä¸è¦ç›´æ¥å…³é—­æµè§ˆå™¨</li>
            </ul>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>BoxIM ENLTbot &copy; 2025 Entropy Light. All rights reserved.</p>
            <p>å½“å‰ç”¨æˆ·: {{ user.username }} ({{ user.role }})</p>
        </div>
    </footer>

    <script src="/static/js/script.js"></script>
    <script>
        document.getElementById('change-password-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                alert('æ–°å¯†ç ä¸åŒ¹é…');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('å¯†ç é•¿åº¦è‡³å°‘6ä½');
                return;
            }
            
            const response = await fetch('/api/change_password', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    current_password: currentPassword,
                    new_password: newPassword,
                    confirm_password: confirmPassword
                })
            });
            
            const result = await response.json();
            alert(result.message || result.error);
            if (result.success) {
                // æ¸…ç©ºè¡¨å•
                document.getElementById('change-password-form').reset();
                // å»ºè®®é‡æ–°ç™»å½•
                if (confirm('å¯†ç ä¿®æ”¹æˆåŠŸï¼Œå»ºè®®é‡æ–°ç™»å½•ã€‚æ˜¯å¦ç°åœ¨é‡æ–°ç™»å½•ï¼Ÿ')) {
                    window.location.href = '/logout';
                }
            }
        });
    </script>
</body>
</html>